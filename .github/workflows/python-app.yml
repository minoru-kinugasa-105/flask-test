name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main  # デプロイするブランチを指定

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.12'

    - name: Install dependencies
      run: |
        pip install flask flask-assets libsass

    - name: Build and generate static files
      run: |
        python -c "
import os
from app import app, assets

with app.app_context():
    assets['scss_all'].build()
    if not os.path.exists('static_output'):
        os.makedirs('static_output')
    app.generate_static_files('static_output')
        "

    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./static_output
